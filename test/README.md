# Testing
All tests are ran within Docker containers via `docker-compose.yml`.

## Production
From the root of the project, build the test docker image, run docker-compose and run the test suite using the following commands:
```sh
# typically, the following will be performed in a CI environment
# rather than directly from a command line
docker-compose build sqler_postgres_dialect
docker-compose up -d
docker logs --details sqler_postgres
docker logs --details sqler_postgres_dialect
docker ps -a
# run the test suite... docker exec -it sqler_postgres_dialect bash "npm test"
source test/run.sh sqler_postgres sqler_postgres_dialect "npm test"
# generate/deploy the docs... docker exec -it sqler_postgres_dialect bash "npm run jsdoc-deploy"
source test/run.sh sqler_postgres sqler_postgres_dialect "npm run jsdocp-deploy"
```

## Development
From the root of the project, build the test docker image and run docker-compose using the following commands:
```sh
docker-compose build sqler_postgres_dialect
docker-compose up --force-recreate
```

### Running Tests
From a different command prompt, run the test suite using the following command:
```sh
docker exec -i sqler_postgres_dialect bash "npm test"
```

### Debugging Tests
From a different command prompt, debug a test function using the following commands:
```sh
docker exec -it sqler_postgres_dialect bash
node --inspect-brk=0.0.0.0 test/lib/main.js someTestFunction -NODE_ENV=test
// connections can be established using the normal debug port of `9229`
```

## External Database Access
When the docker container is running the underlying database should be accessible extrernally using the  default port for the database.

### Generating Docs
Once the docker containers are up and running, the docs can be generated by opening a command prompt and executing the following commands:
```sh
docker exec -it sqler_postgres_dialect bash "npm run jsdocp"
```

The generated docs can be viewed via [http://localhost:4003](http://localhost:4003)
